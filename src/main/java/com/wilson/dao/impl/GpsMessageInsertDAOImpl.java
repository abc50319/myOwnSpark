package com.wilson.dao.impl;import com.wilson.conf.ConfigurationManager;import com.wilson.constant.Constants;import com.wilson.dao.GpsMessageInsertDAO;import com.wilson.domain.GPSMessageOutput;import com.wilson.hbase.factory.HBase;import com.wilson.jdbc.JDBCHbaseHelper;import org.apache.hadoop.hbase.client.*;import org.apache.hadoop.hbase.util.Bytes;import java.util.ArrayList;import java.util.List;/** * GPS统计指标插入Hbase实现类 * @author wilson * @date	2018-01-01 08:00:00 * */public class GpsMessageInsertDAOImpl implements GpsMessageInsertDAO {    /**     * 批量插入用户GPS统计指标     * 欲插入的数据格式为<terminalId_timeId__指标名_指标值>，list     * 插入策略,先根据"__"切分，将前面[0]的作为rowkey，后面的[1]再根据"_"进行切分，插入列值     */    public void insertBatch( String tableName,List<String> gpsMessageOutputsList) {        List<Put> puts = new ArrayList<Put>();        for(String gpsmessage:gpsMessageOutputsList){            Put put = new Put(Bytes.toBytes(gpsmessage.split("__")[0]));            //插入操作            put.addColumn(Bytes.toBytes(ConfigurationManager.getProperty(Constants.HBASE_COLUMN_CLUSTER)),                    Bytes.toBytes(gpsmessage.split("__")[1].split("_")[0]),                    Bytes.toBytes(gpsmessage.split("__")[1].split("_")[1]));            puts.add(put);        }        //HBase.put(tableName, puts, true);        //创建hbasehelper，插入数据        JDBCHbaseHelper jdbcHbaseHelper = new JDBCHbaseHelper();        jdbcHbaseHelper.batchPut(tableName,puts);    }    /**     * 这个方式缺点在于增加了DStream的操作，但是减少了插入Hbase的操作     * 批量插入用户GPS消息     * terminalId_timeId,采集频次_总点数_在线点数_弱信号点数_GPS为未启点数_速度为0点数     * param gpsMessageOutputs     * 已经修改：这是最初的模式，将各个指标进行leftjoin，然后合并成一条数据，转化成GPSMessageOutput对象进行插入操作     *     */    public void insertBatch0(List<GPSMessageOutput> gpsMessageOutputs,String tableName) {        String terminalId;        String timeId;        String frequency;        String totalNum;        String onlineNum;        String weakNum;        String notOpenGpsNum;        String zeroSpeedNum;        String offlineNum = "";        String normalNum = "";        String onlinePercent = "";        int i = 0;        List<Put> puts = new ArrayList<Put>();        for(GPSMessageOutput gpsmessage:gpsMessageOutputs){            terminalId = gpsmessage.getTerminalId();            timeId = gpsmessage.getTimeId();            frequency = gpsmessage.getFrequency();            totalNum = gpsmessage.getTotalNum();            onlineNum = gpsmessage.getOnlineNum();            weakNum = gpsmessage.getWeakNum();            notOpenGpsNum = gpsmessage.getNotOpenGpsNum();            zeroSpeedNum = gpsmessage.getZeroSpeedNum();            offlineNum = gpsmessage.getOfflineNum();            normalNum = gpsmessage.getNormalNum();            onlinePercent = gpsmessage.getOnlinePercent();            Put put = new Put(Bytes.toBytes(timeId+"_"+terminalId));            put.addColumn(Bytes.toBytes("info"), Bytes.toBytes("frequency"), Bytes.toBytes(frequency));            put.addColumn(Bytes.toBytes("info"), Bytes.toBytes("totalNum"), Bytes.toBytes(totalNum));            put.addColumn(Bytes.toBytes("info"), Bytes.toBytes("onlineNum"), Bytes.toBytes(onlineNum));            put.addColumn(Bytes.toBytes("info"), Bytes.toBytes("weakNum"), Bytes.toBytes(weakNum));            put.addColumn(Bytes.toBytes("info"), Bytes.toBytes("notOpenGpsNum"), Bytes.toBytes(notOpenGpsNum));            put.addColumn(Bytes.toBytes("info"), Bytes.toBytes("zeroSpeedNum"), Bytes.toBytes(zeroSpeedNum));            put.addColumn(Bytes.toBytes("info"), Bytes.toBytes("offlineNum"), Bytes.toBytes(offlineNum));            put.addColumn(Bytes.toBytes("info"), Bytes.toBytes("normalNum"), Bytes.toBytes(normalNum));            put.addColumn(Bytes.toBytes("info"), Bytes.toBytes("onlinePercent"), Bytes.toBytes(onlinePercent));            //HBase.put("testlsmuser", Arrays.asList(new Put[]{put}), true);            i++;            //System.out.println("成功插入"+i+"条数据");            if(100 == i){                System.out.println("成功插入"+i+"条数据");            }            puts.add(put);        }        HBase.put(tableName, puts, true);    }}